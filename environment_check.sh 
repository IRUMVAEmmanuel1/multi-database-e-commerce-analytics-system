#!/bin/bash

# environment_check.sh - Check Mac environment for the project

echo "üîç Checking your Mac environment for E-commerce Analytics Project..."
echo "=================================================="

# Check Python version
echo "üêç Python Version:"
if command -v python3 &> /dev/null; then
    python3 --version
    PYTHON_PATH=$(which python3)
    echo "   Location: $PYTHON_PATH"
else
    echo "‚ùå Python 3 not found"
fi

echo ""

# Check pip
echo "üì¶ Pip Version:"
if command -v pip3 &> /dev/null; then
    pip3 --version
else
    echo "‚ùå pip3 not found"
fi

echo ""

# Check if MongoDB is installed
echo "üçÉ MongoDB:"
if command -v mongod &> /dev/null; then
    mongod --version | head -1
    echo "   ‚úÖ MongoDB is installed"
    
    # Check if MongoDB is running
    if pgrep -x "mongod" > /dev/null; then
        echo "   ‚úÖ MongoDB is currently running"
    else
        echo "   ‚ö†Ô∏è  MongoDB is not running (we'll start it later)"
    fi
else
    echo "   ‚ùå MongoDB not found - we'll install it"
fi

echo ""

# Check if Docker is installed (for HBase)
echo "üê≥ Docker:"
if command -v docker &> /dev/null; then
    docker --version
    echo "   ‚úÖ Docker is installed"
    
    # Check if Docker is running
    if docker info &> /dev/null; then
        echo "   ‚úÖ Docker is running"
    else
        echo "   ‚ö†Ô∏è  Docker is not running - please start Docker Desktop"
    fi
else
    echo "   ‚ùå Docker not found - we'll need it for HBase"
fi

echo ""

# Check Java (needed for Spark and HBase)
echo "‚òï Java:"
if command -v java &> /dev/null; then
    java -version 2>&1 | head -1
    echo "   ‚úÖ Java is installed"
    
    # Check JAVA_HOME
    if [ -n "$JAVA_HOME" ]; then
        echo "   ‚úÖ JAVA_HOME is set: $JAVA_HOME"
    else
        echo "   ‚ö†Ô∏è  JAVA_HOME is not set - we'll configure it"
    fi
else
    echo "   ‚ùå Java not found - we'll install it"
fi

echo ""

# Check Homebrew (package manager for Mac)
echo "üç∫ Homebrew:"
if command -v brew &> /dev/null; then
    brew --version | head -1
    echo "   ‚úÖ Homebrew is installed"
else
    echo "   ‚ùå Homebrew not found - we'll install it"
fi

echo ""

# Check available disk space
echo "üíæ Disk Space:"
df -h / | tail -1 | awk '{print "   Available: " $4 " (" $5 " used)"}'

echo ""

# Summary
echo "üìã SUMMARY:"
echo "=================================================="

# Create installation plan
INSTALL_NEEDED=()

if ! command -v brew &> /dev/null; then
    INSTALL_NEEDED+=("Homebrew")
fi

if ! command -v mongod &> /dev/null; then
    INSTALL_NEEDED+=("MongoDB")
fi

if ! command -v docker &> /dev/null; then
    INSTALL_NEEDED+=("Docker Desktop")
fi

if ! command -v java &> /dev/null; then
    INSTALL_NEEDED+=("Java JDK")
fi

if [ ${#INSTALL_NEEDED[@]} -eq 0 ]; then
    echo "‚úÖ All required software is installed!"
    echo "   Next step: Set up the project environment"
else
    echo "‚ö†Ô∏è  Need to install: ${INSTALL_NEEDED[*]}"
    echo "   We'll help you install these next"
fi

echo ""
echo "üéØ Project Directory: $(pwd)"
echo "=================================================="